<style>
.calculator-wrapper { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 1200px; margin: 0 auto; }
.calculator-container { background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; margin: 20px 0; }
.calculator-header { background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); color: white; padding: 30px; text-align: center; }
.calculator-header h1 { font-size: 2.5em; margin-bottom: 10px; font-weight: 300; }
.badge-container { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
.badge { background: rgba(255,255,255,0.2); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.9em; }
.calculator-section { padding: 30px; }
.tab-buttons { display: flex; justify-content: center; margin-bottom: 20px; background: #f8f9fa; padding: 20px; border-radius: 10px; }
.tab-btn { background: #ecf0f1; border: none; padding: 12px 24px; cursor: pointer; font-size: 16px; border-radius: 8px; margin: 0 2px; transition: all 0.3s ease; font-weight: 600; }
.tab-btn:hover { background: #3498db; color: white; }
.tab-btn.active { background: #3498db; color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
.input-group { background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #3498db; }
.input-group h3 { color: #2c3e50; margin-bottom: 15px; font-size: 1.1em; }
.input-field { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; box-sizing: border-box; }
.input-field:focus { outline: none; border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
.tenure-inputs { display: flex; gap: 10px; }
.tenure-inputs > div { flex: 1; }
.calculate-btn { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; width: 100%; margin: 20px 0; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(39, 174, 96, 0.2); }
.calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(39, 174, 96, 0.3); }
.eligibility-btn { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; margin: 10px 0; transition: all 0.3s ease; }
.eligibility-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(155, 89, 182, 0.3); }
.error-message { background: #e74c3c; color: white; padding: 15px; border-radius: 8px; margin: 20px 0; display: none; }
.results-section { background: #f8f9fa; border-radius: 10px; padding: 25px; margin-top: 30px; display: none; }
.results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
.result-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
.result-value { font-size: 24px; font-weight: bold; color: #27ae60; margin: 10px 0; }
.result-label { color: #7f8c8d; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
.table-container { overflow-x: auto; margin-bottom: 20px; }
.amortization-table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.amortization-table th, .amortization-table td { padding: 12px; text-align: right; border-bottom: 1px solid #e9ecef; }
.amortization-table th { background: #2c3e50; color: white; font-weight: 600; text-align: center; }
.amortization-table tr:nth-child(even) { background: #f8f9fa; }
.export-buttons { text-align: center; margin-top: 20px; }
.export-btn { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 0 5px; font-size: 14px; }
.export-btn:hover { background: #2980b9; }
.scenario-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 15px; }
@media (max-width: 768px) { .input-grid { grid-template-columns: 1fr; } .results-grid { grid-template-columns: 1fr; } .tenure-inputs { flex-direction: column; } .calculator-header h1 { font-size: 2em; } .tab-buttons { flex-direction: column; gap: 10px; } .tab-btn { border-radius: 8px; } }
</style>

<div class="calculator-wrapper">
    <div class="calculator-container">
        <div class="calculator-header">
            <h1>üè† Loan EMI Calculator</h1>
            <p>Calculate your Equated Monthly Installment and loan repayment schedule</p>
            <div class="badge-container">
                <span class="badge">Free Tool</span>
                <span class="badge">No Registration</span>
                <span class="badge">Instant Results</span>
                <span class="badge">Amortization Schedule</span>
            </div>
        </div>

        <div class="calculator-section">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('emi')">EMI Calculator</button>
                <button class="tab-btn" onclick="showTab('eligibility')">Loan Eligibility</button>
            </div>

            <div id="emi-tab" class="tab-content active">
                <div class="input-grid">
                    <div class="input-group">
                        <h3>üí∞ Loan Amount</h3>
                        <input type="number" id="loan-amount" class="input-field" placeholder="Enter loan amount" min="1000" step="1000" required>
                        <small>Principal loan amount you want to borrow</small>
                    </div>
                    <div class="input-group">
                        <h3>üìä Annual Interest Rate</h3>
                        <input type="number" id="interest-rate" class="input-field" placeholder="12.0" min="1" max="30" step="0.1" required>
                        <small>Annual interest rate (e.g., 12% = 12.0)</small>
                    </div>
                    <div class="input-group">
                        <h3>‚è∞ Loan Tenure</h3>
                        <div class="tenure-inputs">
                            <div><input type="number" id="tenure-years" class="input-field" placeholder="5" min="1" max="30" required><small>Years</small></div>
                            <div><input type="number" id="tenure-months" class="input-field" placeholder="0" min="0" max="11"><small>Months</small></div>
                        </div>
                    </div>
                </div>

                <div id="emi-error-message" class="error-message"></div>
                <button id="calculate-emi-btn" class="calculate-btn">Calculate EMI</button>

                <div id="emi-results-section" class="results-section">
                    <div class="results-header"><h2>Loan EMI Results</h2><p>Your loan repayment calculation summary</p></div>
                    <div class="results-grid">
                        <div class="result-card"><div class="result-label">Monthly EMI</div><div id="monthly-emi" class="result-value">$0.00</div></div>
                        <div class="result-card"><div class="result-label">Total Amount Payable</div><div id="total-amount" class="result-value">$0.00</div></div>
                        <div class="result-card"><div class="result-label">Total Interest</div><div id="total-interest" class="result-value">$0.00</div></div>
                        <div class="result-card"><div class="result-label">Interest Percentage</div><div id="interest-percentage" class="result-value">0.00%</div></div>
                    </div>

                    <div class="amortization-section">
                        <h3>Amortization Schedule</h3>
                        <p>Month-by-month breakdown of your loan repayment</p>
                        <div class="table-container">
                            <table id="amortization-table" class="amortization-table">
                                <thead><tr><th>Month</th><th>EMI</th><th>Interest</th><th>Principal</th><th>Balance</th></tr></thead>
                                <tbody id="amortization-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="export-buttons">
                        <button id="export-emi-json" class="export-btn">Export JSON</button>
                        <button id="export-emi-csv" class="export-btn">Export CSV</button>
                    </div>
                </div>
            </div>

            <div id="eligibility-tab" class="tab-content">
                <div class="input-grid">
                    <div class="input-group"><h3>üíµ Monthly Income</h3><input type="number" id="monthly-income" class="input-field" placeholder="Enter monthly income" min="1000" step="500" required><small>Your total monthly income</small></div>
                    <div class="input-group"><h3>üí≥ Existing Obligations</h3><input type="number" id="existing-obligations" class="input-field" placeholder="0" min="0" step="100"><small>Current monthly EMIs/debts</small></div>
                    <div class="input-group"><h3>üìä Max EMI Percentage</h3><input type="number" id="max-emi-percentage" class="input-field" placeholder="50" min="10" max="80" step="5" value="50" required><small>Max % of income for EMI (recommended: 50%)</small></div>
                </div>

                <button id="calculate-eligibility-btn" class="eligibility-btn">Calculate Loan Eligibility</button>

                <div id="eligibility-results-section" class="results-section">
                    <div class="results-header"><h2>Loan Eligibility Results</h2><p>Maximum loan amounts you can afford</p></div>
                    <div class="results-grid">
                        <div class="result-card"><div class="result-label">Maximum Monthly EMI</div><div id="max-monthly-emi" class="result-value">$0.00</div></div>
                        <div class="result-card"><div class="result-label">Available EMI</div><div id="available-emi" class="result-value">$0.00</div></div>
                    </div>
                    <div id="scenario-results" class="scenario-grid"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
class LoanEMICalculator {
    constructor() {
        this.emiResults = null;
        this.eligibilityResults = null;
        this.initializeEventListeners();
    }

    initializeEventListeners() {
        const emiBtn = document.getElementById('calculate-emi-btn');
        const eligibilityBtn = document.getElementById('calculate-eligibility-btn');
        const exportEmiJsonBtn = document.getElementById('export-emi-json');
        const exportEmiCsvBtn = document.getElementById('export-emi-csv');

        if (emiBtn) emiBtn.addEventListener('click', () => this.calculateEMI());
        if (eligibilityBtn) eligibilityBtn.addEventListener('click', () => this.calculateEligibility());
        if (exportEmiJsonBtn) exportEmiJsonBtn.addEventListener('click', () => this.exportEMIJSON());
        if (exportEmiCsvBtn) exportEmiCsvBtn.addEventListener('click', () => this.exportEMICSV());
    }

    calculateEMI() {
        const loanAmount = parseFloat(document.getElementById('loan-amount').value);
        const interestRate = parseFloat(document.getElementById('interest-rate').value) / 100;
        const tenureYears = parseInt(document.getElementById('tenure-years').value);
        const tenureMonths = parseInt(document.getElementById('tenure-months').value) || 0;

        if (!loanAmount || loanAmount < 1000) {
            this.showError('emi-error-message', 'Please enter a valid loan amount (minimum $1,000)');
            return;
        }
        if (!interestRate || interestRate < 0.01 || interestRate > 0.3) {
            this.showError('emi-error-message', 'Please enter a valid interest rate between 1% and 30%');
            return;
        }
        if (!tenureYears || tenureYears < 1 || tenureYears > 30) {
            this.showError('emi-error-message', 'Please enter loan tenure between 1 and 30 years');
            return;
        }

        this.hideError('emi-error-message');

        const btn = document.getElementById('calculate-emi-btn');
        btn.textContent = 'Calculating...';
        btn.disabled = true;

        setTimeout(() => {
            this.emiResults = this.calculateEMIValues(loanAmount, interestRate, tenureYears, tenureMonths);
            this.displayEMIResults();
            btn.textContent = 'Calculate EMI';
            btn.disabled = false;
        }, 500);
    }

    calculateEMIValues(principal, annualRate, years, months) {
        const totalMonths = (years * 12) + months;
        const monthlyRate = annualRate / 12;
        const emi = principal * monthlyRate * Math.pow(1 + monthlyRate, totalMonths) / (Math.pow(1 + monthlyRate, totalMonths) - 1);
        const totalAmount = emi * totalMonths;
        const totalInterest = totalAmount - principal;

        const schedule = [];
        let remainingBalance = principal;
        for (let month = 1; month <= totalMonths; month++) {
            const interestPayment = remainingBalance * monthlyRate;
            const principalPayment = emi - interestPayment;
            remainingBalance = Math.max(0, remainingBalance - principalPayment);
            schedule.push({month, emi, interestPayment, principalPayment, remainingBalance});
        }

        return {loanAmount: principal, annualRate, tenureYears: years, tenureMonths: months, totalMonths, monthlyEMI: emi, totalAmount, totalInterest, interestPercentage: (totalInterest / principal) * 100, amortizationSchedule: schedule};
    }

    displayEMIResults() {
        const results = this.emiResults;
        document.getElementById('monthly-emi').textContent = this.formatCurrency(results.monthlyEMI);
        document.getElementById('total-amount').textContent = this.formatCurrency(results.totalAmount);
        document.getElementById('total-interest').textContent = this.formatCurrency(results.totalInterest);
        document.getElementById('interest-percentage').textContent = results.interestPercentage.toFixed(2) + '%';

        this.displayAmortizationTable();
        document.getElementById('emi-results-section').style.display = 'block';
        document.getElementById('emi-results-section').scrollIntoView({ behavior: 'smooth' });
    }

    displayAmortizationTable() {
        const tbody = document.getElementById('amortization-body');
        tbody.innerHTML = '';
        const schedule = this.emiResults.amortizationSchedule;
        const showSchedule = schedule.length <= 24 ? schedule : [...schedule.slice(0, 12), ...schedule.slice(-12)];

        showSchedule.forEach((payment, index) => {
            if (schedule.length > 24 && index === 12) {
                const separatorRow = document.createElement('tr');
                separatorRow.innerHTML = '<td colspan="5" style="text-align: center; font-style: italic; color: #7f8c8d;">... ' + (schedule.length - 24) + ' months ...</td>';
                tbody.appendChild(separatorRow);
            }
            const row = document.createElement('tr');
            row.innerHTML = '<td>' + payment.month + '</td><td>' + this.formatCurrency(payment.emi) + '</td><td>' + this.formatCurrency(payment.interestPayment) + '</td><td>' + this.formatCurrency(payment.principalPayment) + '</td><td>' + this.formatCurrency(payment.remainingBalance) + '</td>';
            tbody.appendChild(row);
        });
    }

    calculateEligibility() {
        const monthlyIncome = parseFloat(document.getElementById('monthly-income').value);
        const existingObligations = parseFloat(document.getElementById('existing-obligations').value) || 0;
        const maxEMIPercentage = parseFloat(document.getElementById('max-emi-percentage').value) / 100;

        if (!monthlyIncome || monthlyIncome < 1000) {
            this.showError('eligibility-error-message', 'Please enter a valid monthly income (minimum $1,000)');
            return;
        }

        this.eligibilityResults = this.calculateEligibilityValues(monthlyIncome, existingObligations, maxEMIPercentage);
        this.displayEligibilityResults();
    }

    calculateEligibilityValues(monthlyIncome, existingObligations, maxEMIPercentage) {
        const maxEMI = monthlyIncome * maxEMIPercentage;
        const availableEMI = Math.max(0, maxEMI - existingObligations);

        const scenarios = [];
        const rates = [0.08, 0.10, 0.12, 0.14];
        const tenures = [5, 10, 15, 20];

        rates.forEach(rate => {
            tenures.forEach(tenure => {
                const monthlyRate = rate / 12;
                const totalMonths = tenure * 12;
                let maxLoan = 0;
                if (availableEMI > 0) {
                    maxLoan = availableEMI * (Math.pow(1 + monthlyRate, totalMonths) - 1) / (monthlyRate * Math.pow(1 + monthlyRate, totalMonths));
                }
                scenarios.push({rate, tenure, maxLoan, monthlyEMI: availableEMI});
            });
        });

        return {monthlyIncome, existingObligations, maxEMIPercentage, maxEMI, availableEMI, scenarios};
    }

    displayEligibilityResults() {
        const results = this.eligibilityResults;
        document.getElementById('max-monthly-emi').textContent = this.formatCurrency(results.maxEMI);
        document.getElementById('available-emi').textContent = this.formatCurrency(results.availableEMI);

        const scenarioContainer = document.getElementById('scenario-results');
        scenarioContainer.innerHTML = '';

        results.scenarios.forEach(scenario => {
            const card = document.createElement('div');
            card.className = 'result-card';
            card.innerHTML = '<h4>' + (scenario.rate * 100).toFixed(1) + '% rate, ' + scenario.tenure + ' years</h4><div class="result-value">' + this.formatCurrency(scenario.maxLoan) + '</div><div class="result-label">Monthly EMI: ' + this.formatCurrency(scenario.monthlyEMI) + '</div>';
            scenarioContainer.appendChild(card);
        });

        document.getElementById('eligibility-results-section').style.display = 'block';
        document.getElementById('eligibility-results-section').scrollIntoView({ behavior: 'smooth' });
    }

    formatCurrency(amount) { return new Intl.NumberFormat('en-US', {style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2}).format(amount); }

    showError(elementId, message) {
        const errorDiv = document.getElementById(elementId);
        if (errorDiv) {
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            errorDiv.scrollIntoView({ behavior: 'smooth' });
        }
    }

    hideError(elementId) {
        const errorDiv = document.getElementById(elementId);
        if (errorDiv) errorDiv.style.display = 'none';
    }

    exportEMIJSON() {
        if (!this.emiResults) return;
        const dataStr = JSON.stringify(this.emiResults, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        this.downloadBlob(dataBlob, 'loan_emi_results.json');
    }

    exportEMICSV() {
        if (!this.emiResults) return;
        let csv = 'Month,EMI,Interest Payment,Principal Payment,Remaining Balance\n';
        this.emiResults.amortizationSchedule.forEach(payment => {
            csv += payment.month + ',' + payment.emi + ',' + payment.interestPayment + ',' + payment.principalPayment + ',' + payment.remainingBalance + '\n';
        });
        const dataBlob = new Blob([csv], {type: 'text/csv'});
        this.downloadBlob(dataBlob, 'loan_amortization_schedule.csv');
    }

    downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
}

function showTab(tabName) {
    const tabs = document.querySelectorAll('.tab-content');
    const buttons = document.querySelectorAll('.tab-btn');
    tabs.forEach(tab => tab.classList.remove('active'));
    buttons.forEach(btn => btn.classList.remove('active'));
    document.getElementById(tabName + '-tab').classList.add('active');
    event.target.classList.add('active');
}

document.addEventListener('DOMContentLoaded', () => { new LoanEMICalculator(); });
</script>